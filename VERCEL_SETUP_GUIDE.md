# Vercel Integration Setup Guide

This guide will help you set up Vercel integration for the autonomous deployment workflow.

## Prerequisites

- Vercel account (free tier is sufficient)
- Repository pushed to GitHub
- Local Vercel CLI installed

## Step 1: Initialize Vercel Project

```bash
# Login to Vercel (if not already logged in)
vercel login

# Link the repository to a Vercel project
cd /workspaces/MaintAInPro
vercel --confirm

# This will create .vercel/project.json with your project configuration
```

## Step 2: Get Required Values

After running `vercel --confirm`, you'll need these values:

```bash
# Get your Vercel Organization ID
vercel teams list

# Get your Project ID (from .vercel/project.json)
cat .vercel/project.json

# Create a Vercel API Token
# Go to: https://vercel.com/account/tokens
# Create token with scope: "Full Access" or "Deploy, Read"
```

## Step 3: Add GitHub Secrets

Add these secrets to your GitHub repository:

1. Go to: `https://github.com/Coding-Krakken/MaintAInPro/settings/secrets/actions`
2. Click "New repository secret" for each:

```bash
VERCEL_TOKEN          # Your Vercel API token
VERCEL_ORG_ID         # Your Vercel organization/team ID  
VERCEL_PROJECT_ID     # Your Vercel project ID
```

## Step 4: Configure Environment Variables

In your Vercel dashboard, add these environment variables:

1. Go to: `https://vercel.com/your-team/maintainpro/settings/environment-variables`
2. Add variables for all environments (Production, Preview, Development):

```bash
# Database
DATABASE_URL          # Your PostgreSQL connection string
DATABASE_URL_UNPOOLED # Direct PostgreSQL connection (if using pooling)

# Authentication  
JWT_SECRET           # JWT signing secret
NEXTAUTH_SECRET      # NextAuth.js secret

# Optional integrations
OPENAI_API_KEY       # For AI features
SENTRY_DSN          # For error tracking
```

## Step 5: Test Local Deployment

```bash
# Test the build locally
npm run build

# Test with Vercel dev environment
vercel dev

# Deploy to preview environment  
vercel

# Deploy to production
vercel --prod
```

## Step 6: Verify Health Endpoint

After deployment, check the health endpoint:

```bash
# Replace with your actual Vercel URL
curl https://your-project.vercel.app/health

# Should return JSON with system status
```

## Step 7: Test Workflow Integration

1. Create a test branch and push changes
2. Verify the deploy workflow runs successfully
3. Check that health checks pass
4. Confirm automatic rollback works if health checks fail

## Common Issues

### Build Failures
- Ensure all dependencies are in `package.json`
- Check Node.js version compatibility (using Node 18)
- Verify TypeScript configuration

### Database Connection Issues
- Confirm `DATABASE_URL` is correctly formatted
- Test connection from Vercel Functions
- Check firewall/security group settings

### Health Check Failures
- Verify `/health` endpoint responds correctly
- Check server startup time (increase timeout if needed)
- Review server logs in Vercel dashboard

## Vercel Configuration Files

The project includes:
- `vercel.json` - Build and routing configuration
- `server/health.ts` - Health check endpoint
- `.github/workflows/deploy.yml` - Deployment automation

## Security Notes

- Use environment variables for all secrets
- Enable Vercel's security headers
- Consider using Vercel's Edge Config for feature flags
- Regularly rotate API tokens

## Next Steps

After Vercel is configured:
1. The deploy workflow will automatically run on pushes to main/Replit
2. Health checks will validate deployments
3. Failed deployments will automatically rollback
4. GitHub Issues will be created for deployment failures

## Support

If you encounter issues:
1. Check Vercel deployment logs: `vercel logs`
2. Review GitHub Actions logs
3. Verify all environment variables are set
4. Test local deployment first

---

**Generated by Autonomous Loop Implementation**
*Last updated: {{ current_date }}*
